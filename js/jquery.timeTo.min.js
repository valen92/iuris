/**
 * TimeTo jQuery plug-in
 * Show countdown timer or realtime clock
 *
 * @author Alexey Teterin <altmoc@gmail.com>
 * @version 1.1.0
 * @license MIT http://opensource.org/licenses/MIT
 * @date 2015-11-16
 */
(function(k){if("object"===typeof exports){var q=require("jquery");module.exports=k(q||$)}else"function"===typeof define&&define.amd?define(["jquery"],k):k(q||$)})(function(k){function q(c,e){var b=this.data(),d=this.find("ul"),f=!1;if(b.vals&&0!==d.length){c||(c=b.seconds);b.intervalId&&(f=!0,clearTimeout(b.intervalId));for(var g=Math.floor(c/86400),l=86400*g,a=Math.floor((c-l)/3600),l=l+3600*a,n=Math.floor((c-l)/60),l=c-(l+60*n),g=(100>g?"0"+(10>g?"0":""):"")+g+(10>a?"0":"")+a+(10>n?"0":"")+n+(10>l?"0":"")+l,a=b.vals.length-1,n=g.length-1;0<=a;a--,n--)l=parseInt(g.substr(n,1)),b.vals[a]=l,d.eq(a).children().html(l);if(f||e){var r=this;b.ttStartTime=k.now();b.intervalId=setTimeout(function(){p.call(r)},1E3);this.data("intervalId",b.intervalId)}}}function p(c){var e=this.find("ul"),b=this.data();if(b.vals&&0!=e.length){void 0==c&&(c=b.iSec);var d=b.vals[c],f=e.eq(c),g=f.children(),l=b.countdown?-1:1;g.eq(1).html(d);d+=l;if(c==b.iSec){var a=b.tickTimeout,n=k.now()-b.ttStartTime;b.sec+=l;a+=Math.abs(b.seconds-b.sec)*a-n;b.intervalId=setTimeout(function(){p.call(r)},a)}if(0>d||d>b.limits[c])0>d?(d=b.limits[c],c==b.iHour&&0<b.displayDays&&0<c&&0==b.vals[c-1]&&(d=3)):d=0,0<c&&p.call(this,c-1);g.eq(0).html(d);var r=this;k.support.transition?(f.addClass("transition"),f.css({top:0}),setTimeout(function(){f.removeClass("transition");g.eq(1).html(d);f.css({top:"-"+b.height+"px"});0<l||c!=b.iSec||(b.sec==b.countdownAlertLimit&&e.parent().addClass("timeTo-alert"),0===b.sec&&(e.parent().removeClass("timeTo-alert"),b.intervalId&&(clearTimeout(b.intervalId),r.data("intervalId",null)),"function"===typeof b.callback&&b.callback()))},410)):f.stop().animate({top:0},400,c!=b.iSec?null:function(){g.eq(1).html(d);f.css({top:"-"+b.height+"px"});0<l||c!=b.iSec||(b.sec==b.countdownAlertLimit?e.parent().addClass("timeTo-alert"):0==b.sec&&(e.parent().removeClass("timeTo-alert"),b.intervalId&&(clearTimeout(b.intervalId),r.data("intervalId",null)),"function"===typeof b.callback&&b.callback()))});b.vals[c]=d}else b.intervalId&&(clearTimeout(b.intervalId),this.data("intervalId",null)),b.callback&&b.callback()}var t={callback:null,captionSize:0,countdown:!0,countdownAlertLimit:10,displayCaptions:!1,displayDays:0,displayHours:!0,fontFamily:"Verdana, sans-serif",fontSize:0,lang:"en",seconds:0,start:!0,theme:"white",width:25,height:30,gap:11,vals:[0,0,0,0,0,0,0,0,0],limits:[9,9,9,2,9,5,9,5,9],iSec:8,iHour:4,tickTimeout:1E3,intervalId:null},u={start:function(c){c&&q.call(this,c);var e=this;c=setTimeout(function(){p.call(e)},1E3);this.data("ttStartTime",(new Date).getTime());this.data("intervalId",c)},stop:function(){var c=this.data();c.intervalId&&(clearTimeout(c.intervalId),this.data("intervalId",null));return c},reset:function(c){var e=u.stop.call(this);this.find("div").css({backgroundPosition:"left center"});this.find("ul").parent().removeClass("timeTo-alert");"undefined"===typeof c&&(c=e.value);q.call(this,c,!0)}},v={en:{days:"days",hours:"hours",min:"minutes",sec:"seconds"},ru:{days:"дней",hours:"часов",min:"минут",sec:"секунд"},ua:{days:"днів",hours:"годин",min:"хвилин",sec:"секунд"},de:{days:"Tag",hours:"Uhr",min:"Minuten",sec:"Secunden"},fr:{days:"jours",hours:"heures",min:"minutes",sec:"secondes"},sp:{days:"d\u00edas",hours:"reloj",min:"minutos",sec:"segundos"},it:{days:"giorni",hours:"ore",min:"minuti",sec:"secondi"},nl:{days:"dagen",hours:"uren",min:"minuten",sec:"seconden"},no:{days:"dager",hours:"timer",min:"minutter",sec:"sekunder"},pt:{days:"dias",hours:"horas",min:"minutos",sec:"segundos"}};"undefined"===typeof k.support.transition&&(k.support.transition=function(){var c=(document.body||document.documentElement).style;return void 0!==c.transition||void 0!==c.WebkitTransition||void 0!==c.MozTransition||void 0!==c.MsTransition||void 0!==c.OTransition}());k.fn.timeTo=function(){var c,e={},b,d,f,g=k.now();for(b=0;d=arguments[b];++b)0==b&&"string"===typeof d?c=d:"object"===typeof d?"function"===typeof d.getTime?e.timeTo=d:e=k.extend(e,d):"function"===typeof d?e.callback=d:(d=parseInt(d,10),isNaN(d)||(e.seconds=d));if(e.timeTo)e.timeTo.getTime?f=e.timeTo.getTime():"number"===typeof e.timeTo&&(f=e.timeTo),e.timeTo>g&&(e.seconds=Math.floor((f-g)/1E3));else if(e.time||!e.seconds)if((f=e.time)||(f=new Date),"object"===typeof f&&f.getTime)e.seconds=3600*f.getHours()+60*f.getMinutes()+f.getSeconds(),e.countdown=!1;else if("string"===typeof f){b=f.split(":");f=0;for(g=1;d=b.pop();)f+=d*g,g*=60;e.seconds=f;e.countdown=!1}!1!==e.countdown&&86400<e.seconds&&"undefined"===typeof e.displayDays?(b=Math.floor(e.seconds/86400),e.displayDays=10>b&&1||100>b&&2||3):!0===e.displayDays?e.displayDays=3:e.displayDays&&(e.displayDays=0<e.displayDays?Math.floor(e.displayDays):3);return this.each(function(){var b=k(this),a=b.data(),d,f={},h;a.intervalId&&(clearInterval(a.intervalId),a.intervalId=null);if(a.vals&&"reset"!==c)k.extend(a,e);else{d=a.opt?a.options:e;for(h in t)k.isArray(t[h])?f[h]=t[h].slice(0):f[h]=t[h];a=k.extend(f,d);a.options=d;a.height=Math.round(100*a.fontSize/93)||a.height;a.width=Math.round(.8*a.fontSize+.13*a.height)||a.width;a.displayHours=!(!a.displayDays&&!a.displayHours);h={fontFamily:a.fontFamily};0<a.fontSize&&(h.fontSize=a.fontSize+"px");b.addClass("timeTo").addClass("timeTo-"+a.theme).css(h);d='<ul style="left:'+Math.round(a.height/10)+"px; top:-"+a.height+'px"><li>0</li><li>0</li></ul></div>';f=a.fontSize?' style="width:'+a.width+"px; height:"+a.height+'px;"':' style=""';h='<div class="first"'+f+">"+d;d="<div"+f+">"+d;var g=Math.round(2*a.width+3),m=a.captionSize||a.fontSize&&Math.round(.43*a.fontSize),f=m?"font-size:"+m+"px;":"",m=m?' style="'+f+'"':"",g=(a.displayCaptions?(a.displayHours?'<figure style="max-width:'+g+'px">$1<figcaption'+m+">"+v[a.lang].hours+"</figcaption></figure><span>:</span>":"")+'<figure style="max-width:'+g+'px">$1<figcaption'+m+">"+v[a.lang].min+'</figcaption></figure><span>:</span><figure style="max-width:'+g+'px">$1<figcaption'+m+">"+v[a.lang].sec+"</figcaption></figure>":(a.displayHours?"$1<span>:</span>":"")+"$1<span>:</span>$1").replace(/\$1/g,h+d);if(0<a.displayDays){var m=.4*a.fontSize||t.gap,p=h;for(h=a.displayDays-1;0<h;h--)p+=1===h?d.replace('">',"margin-right:"+Math.round(m)+'px">'):d;g=(a.displayCaptions?'<figure style="width:'+Math.round(a.width*a.displayDays+m+4)+'px">$1<figcaption style="'+f+"padding-right:"+Math.round(m)+'px">'+v[a.lang].days+"</figcaption></figure>":"$1").replace(/\$1/,p)+g}b.html(g)}d=b.find("div");if(d.length<a.vals.length){f=a.vals.length-d.length;g=a.vals;m=a.limits;a.vals=[];a.limits=[];for(h=0;h<d.length;h++)a.vals[h]=g[f+h],a.limits[h]=m[f+h];a.iSec=a.vals.length-1;a.iHour=a.vals.length-5}a.sec=a.seconds;b.data(a);c&&u[c]?u[c].call(b,a.seconds):a.start?u.start.call(b,a.seconds):q.call(b,a.seconds)})};return jQuery});